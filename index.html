<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VdoCipher Video Embed</title>
</head>
<body>

    <h1>VdoCipher Video Embed</h1>

    <div id="videoContainer">
        <!-- The iframe will be dynamically added here -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Function to make a POST API call
            function makePostRequest() {
                // https://cors-anywhere.herokuapp.com/
                const apiUrl = 'https://dev.vdocipher.com/api/videos/1ecea73bf1044abb90d4fec1b9b39872/otp';
                const apiSecretKey = 'rAJ0b4D8snjx8zSLc6MArhRpRnkhCXyJzWQUEf689ppBbxSLMCpsIZyDclNqkftu'; // Replace with your actual API secret key
                
                // Sample data to be sent in the request body
                const postData = {
                    ttl: 300
                };

                // Making a POST request using the Fetch API
                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Apisecret ${apiSecretKey}`,
                        'Content-Type': 'application/json',
                        // Add any other headers as needed
                        'Access-Control-Allow-Origin': '*',
                        'Access-Control-Allow-Methods': '*',
                        'Access-Control-Allow-Headers': '*'
                    },
                    body: JSON.stringify(postData)
                })
                .then(response => response.json())
                .then(data => {
                    // Handle the response data
                    console.log('API Response:', data);

                    // Extract OTP and playbackInfo from the response
                    const receivedOTP = data.otp;
                    const receivedPlaybackInfo = data.playbackInfo;

                    // Embed the video using the received OTP and playbackInfo
                    embedVideo(receivedOTP, receivedPlaybackInfo);
                })
                .catch(error => {
                    // Handle errors
                    console.error('Error:', error);
                });
            }

            // Function to embed the video using OTP and playbackInfo
            function embedVideo(otp, playbackInfo) {
                const iframeSrc = `https://player.vdocipher.com/v2/?otp=${otp}&playbackInfo=${playbackInfo}`;

                // Create an iframe element
                const iframe = document.createElement('iframe');
                iframe.src = iframeSrc;
                iframe.style.border = '0';
                iframe.style.width = '720px';
                iframe.style.height = '405px';
                iframe.allow = 'encrypted-media';
                iframe.allowFullscreen = true;

                // Append the iframe to the video container
                document.getElementById('videoContainer').appendChild(iframe);
            }

            // Call the API function when a button is clicked
            document.getElementById('postButton').addEventListener('click', makePostRequest);
        });
    </script>

    <!-- Button to trigger the API call -->
    <button id="postButton">Make API Call and Embed Video</button>

</body>
</html>
